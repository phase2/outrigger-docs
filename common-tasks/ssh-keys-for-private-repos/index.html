<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Phase2">
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>SSH Keys for private repos - Outrigger Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "SSH Keys for private repos";
    var mkdocs_page_input_path = "common-tasks/ssh-keys-for-private-repos.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-305109-83', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Outrigger Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Getting Started</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../getting-started/system-requirements/">System Requirements</a>
                </li>
                <li class="">
                    
    <a class="" href="../../getting-started/mac-installation/">Mac Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../getting-started/linux-installation/">Linux Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../getting-started/windows-installation/">Windows Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../getting-started/first-steps/">First Steps</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Project Setup</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../project-setup/key-concepts/">Key Concepts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../project-setup/new-projects/">New Projects</a>
                </li>
                <li class="">
                    
    <a class="" href="../../project-setup/existing-projects/">Existing Projects</a>
                </li>
                <li class="">
                    
    <a class="" href="../../project-setup/project-configuration/">Project Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../project-setup/filesystem-sync/">Filesystem Sync</a>
                </li>
                <li class="">
                    
    <a class="" href="../../project-setup/docker-images/">Docker Images</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Common Tasks</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../starting-your-project-containers/">Starting your project containers</a>
                </li>
                <li class="">
                    
    <a class="" href="../stopping-containers-and-cleanup/">Stopping containers and cleanup</a>
                </li>
                <li class="">
                    
    <a class="" href="../using-the-build-container/">Using the build container</a>
                </li>
                <li class="">
                    
    <a class="" href="../working-with-volumes/">Working with Volumes</a>
                </li>
                <li class="">
                    
    <a class="" href="../working-offline/">Working Offline</a>
                </li>
                <li class="">
                    
    <a class="" href="../ssh-into-a-container/">SSH into a container</a>
                </li>
                <li class="">
                    
    <a class="" href="../customizing-container-configuration/">Changing container configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../using-watches/">Using watches</a>
                </li>
                <li class="">
                    
    <a class="" href="../using-xdebug-with-outrigger/">Using Xdebug with Outrigger</a>
                </li>
                <li class="">
                    
    <a class="" href="../accessing-logs/">Accessing logs</a>
                </li>
                <li class="">
                    
    <a class="" href="../inter-vm-communication/">Accessing containers from other VMs</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">SSH Keys for private repos</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#ssh-keys-for-private-repositories">SSH Keys for Private Repositories</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#forwardimport-your-ssh-key-into-the-build-container-to-clone-private-repositories">Forward/Import your SSH Key into the build container to clone private repositories</a></li>
        
            <li><a class="toctree-l4" href="#passphrase-protected-keys">Passphrase Protected Keys</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../setting-up-mail/">Setting up mail</a>
                </li>
                <li class="">
                    
    <a class="" href="../dns-resolution/">DNS Resolution</a>
                </li>
                <li class="">
                    
    <a class="" href="../upgrading-rig/">Upgrading Rig</a>
                </li>
                <li class="">
                    
    <a class="" href="../multiple-docker-machines/">Multiple Docker Machines</a>
                </li>
                <li class="">
                    
    <a class="" href="../routine-image-maintenance/">Routine Image Maintenance</a>
                </li>
                <li class="">
                    
    <a class="" href="../creating-your-own-images/">Creating your own images</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">FAQ</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../faq/general/">General</a>
                </li>
                <li class="">
                    
    <a class="" href="../../faq/troubleshooting/">Troubleshooting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../faq/docker-for-mac/">Docker for Mac</a>
                </li>
                <li class="">
                    
    <a class="" href="../../faq/how-to-contribute/">How to contribute</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Appendix</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../appendix/glossary/">Glossary</a>
                </li>
                <li class="">
                    
    <a class="" href="../../appendix/return-codes/">Return Codes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../appendix/architecture/">Architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../../appendix/background/">Background</a>
                </li>
                <li class="">
                    
    <a class="" href="../../appendix/library/">Library</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Outrigger Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Common Tasks &raquo;</li>
        
      
    
    <li>SSH Keys for private repos</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/phase2/outrigger-docs/edit/master/docs/common-tasks/ssh-keys-for-private-repos.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="ssh-keys-for-private-repositories">SSH Keys for Private Repositories</h1>
<h2 id="forwardimport-your-ssh-key-into-the-build-container-to-clone-private-repositories">Forward/Import your SSH Key into the build container to clone private repositories</h2>
<p>Certain containers like Jenkins and build may need your private key. This is supported by importing your 
private key into the container via a volume mount.</p>
<p>To get your private key into the build container, volume mount your key into the container at <code>/root/.ssh/outrigger.key</code> 
and it will be processed accordingly.</p>
<p><code>~/.ssh/id_rsa:/root/.ssh/outrigger.key</code></p>
<h2 id="passphrase-protected-keys">Passphrase Protected Keys</h2>
<p>For interactive operations, such as use of the build container, passphrase protected
keys do not pose a challenge as you can enter the passphrase when prompted. Services
like Jenkins, however, can prove problematic. A solution to this is to use a container
running an SSH agent with your key added and unlocked. Your container will be able
to connect with the SSH agent via the use of a shared volume and the SSH_AUTH_SOCK
variable that points to it.</p>
<h3 id="ssh-agent-container">SSH Agent Container</h3>
<p>The following is an docker compose file, ssh.yml, with services defined to help run
the necessary container for the agent and add your desired keys. It is set up for a
single SSH agent to share with all of your projects. If you prefer project specific
SSH agents, remove the <code>external: true</code> declaration in all sample files.</p>
<p>In order to have a single agent for all projects, first create a named volume
using <code>docker volume create --name=ssh</code>. This only needs to be done once and you'll
be prompted to do so if you forget.</p>
<pre><code># ssh.yml
# Provides a service for the ssh-agent and a service for adding keys to it
#
# Agent will need to be restarted and have key(s) re-added to it any time your
# docker host is restarted.
#
version: '3.2'

services:
  # use via docker-compose -f ssh.yml up [-d] ssh-agent
  ssh-agent:
    container_name: ssh-agent
    image: whilp/ssh-agent:latest
    volumes:
      - ssh:/ssh

  # use via docker-compose -f ssh.yml run --rm ssh-add $HOME/.ssh/name_of_desired_key
  ssh-add:
    image: whilp/ssh-agent:latest
    entrypoint: [ &quot;ssh-add&quot; ]
    volumes:
      - ssh:/ssh
      - $HOME:$HOME

volumes:
  ssh:
    external: true
</code></pre>

<h3 id="connecting-to-the-ssh-agent-from-other-containers">Connecting to the SSH Agent from other containers</h3>
<p>Any container you want to connect to the SSH agent needs to set the environmental
variable SSH_AUTH_SOCK to /ssh/auth/sock and mount the ssh volume at path /ssh.</p>
<p>Here is an example ssh.overrides.yml file which shows how to add SSH agent access
to services from the <a href="../using-the-build-container/">build container</a>.
To use this file run <code>docker-compose -f build.yml -f ssh.overrides.yml run --rm DESIRED_SERVICE</code></p>
<div class="admonition note">
<p class="admonition-title">Overrides and extends</p>
<p>Overrides do not carry through to services extending an overridden service.
The example below demonstrates that one needs to define the override for each
service where it should apply even though in a typical build.yml file
the cli service is a descendant of the base service. </p>
</div>
<pre><code># ssh.overrides.yml

version: '2.1'

services:
  cli:
    volumes:
      - ssh:/ssh
    environment:
      SSH_AUTH_SOCK: /ssh/auth/sock
  base:
    volumes:
      - ssh:/ssh
    environment:
      SSH_AUTH_SOCK: /ssh/auth/sock
volumes:
  ssh:
    external: true
</code></pre>

<p>The SSH agent configuration can also be placed into your build.yml file directly
if it is relevant for all team members.</p>
<h3 id="more-resources">More Resources</h3>
<p>Additional information, including ways to have non-root container processes access
the authorization socket can be found in the <a href="https://github.com/whilp/ssh-agent">whilp/ssh-agent README</a> image.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../setting-up-mail/" class="btn btn-neutral float-right" title="Setting up mail">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../inter-vm-communication/" class="btn btn-neutral" title="Accessing containers from other VMs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/phase2/outrigger-docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../inter-vm-communication/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../setting-up-mail/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
